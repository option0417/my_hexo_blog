
<!DOCTYPE html>
<html lang="en,zh-tw,default">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Just For Fun">
    <title>Archives - Just For Fun</title>
    <meta name="author" content="W.D">
    
    
    
    <meta name="description" content="programmer, play a lot in the backend">
<meta property="og:type" content="blog">
<meta property="og:title" content="Just For Fun">
<meta property="og:url" content="https://option0417.github.io/archives/index.html">
<meta property="og:site_name" content="Just For Fun">
<meta property="og:description" content="programmer, play a lot in the backend">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Just For Fun">
<meta name="twitter:description" content="programmer, play a lot in the backend">
    
    
        
    
    
        <meta property="og:image" content="https://option0417.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Just For Fun</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">W.D</h4>
                
                    <h5 class="sidebar-profile-bio"><p><em>programmer and play a lot in backend.</em></p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/option0417" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/option0417" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/06/26/Weekly-reading-2017-Jun-19-25/">
                            Weekly reading (2017/Jun 19-25)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-06-26T00:00:00+08:00">
	
		    Jun 26, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="Where-should-I-put-script-tags-in-HTML-markup"><a href="#Where-should-I-put-script-tags-in-HTML-markup" class="headerlink" title="Where should I put script tags in HTML markup?"></a><a href="https://stackoverflow.com/questions/436411/where-should-i-put-script-tags-in-html-markup" target="_blank" rel="external">Where should I put <em>script</em> tags in HTML markup?</a></h2><p>  最近再次回歸 <em>Javascript</em> 的懷抱，因此才有機會來研究一下為何 <em><strong>script</strong></em> 的宣告要放在 Body的最後一行，也就是的上面，<br>  文章中有解釋這其實關係到 browser 解析 HTML 跟 Javascript 的方式，且在 HTML5 也提供了 <strong>async</strong> 和 <strong>defer</strong> 來處理這個問題。<br>  掰惹未，目前處於只會用<a href="http://vanilla-js.com" target="_blank" rel="external">vanilla.js</a>的狀態，有需要再來找套framework來用吧！</p>
<h2 id="Double-precision-floating-point-format"><a href="#Double-precision-floating-point-format" class="headerlink" title="Double-precision floating-point format"></a><a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format" target="_blank" rel="external">Double-precision floating-point format</a></h2><p>  如上述，最近在進行 <em>Javascript</em> 的開發，因會需要儲存 <em>時間戳記 (Timestamp)</em> 這樣的資料欄位，也才想到 js 中對於數字的設計和定義是怎樣的，如 Java 和 C 會有 int, long, double 這樣的差異。 而原來 js 中對數字一律定義為 double-precision floating-point，也就是 Double 的概念！</p>
<h2 id="An-Empirical-Study-of-Load-Balancing-Algorithms"><a href="#An-Empirical-Study-of-Load-Balancing-Algorithms" class="headerlink" title="An Empirical Study of Load Balancing Algorithms"></a><a href="http://liblb.com/study.html" target="_blank" rel="external">An Empirical Study of Load Balancing Algorithms</a></h2><p>  基本上是介紹一個以 Go 寫成的 Load Balance service，但主要作者對於所用的演算法 <em>Round Robin</em>、 <em>Two Random Choices</em>、 <em>Consistent Hashing</em> 、 <em>Bounded Consistent Hashing</em>有著不錯的優劣分析，以及比較。總之，就是乾貨！</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/06/26/Weekly-reading-2017-Jun-19-25/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/06/19/Weekly-reading-2017-Jun-12-18/">
                            Weekly reading (2017/Jun 12-18)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-06-19T00:00:00+08:00">
	
		    Jun 19, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="You-are-not-Google"><a href="#You-are-not-Google" class="headerlink" title="You are not Google"></a><a href="https://blog.bradfieldcs.com/you-are-not-google-84912cf44afb" target="_blank" rel="external">You are not Google</a></h2><p>  作者指出軟體工程師常會因業界大頭(例如: Google) 或論壇熱門討論的技術，一頭熱的想導入自己的系統架構中，而忽略的是否真的需要這樣的技術以及真正的問題。<br>  作者亦提出了 <strong>UNPHAT</strong> 的自我審視方式，來檢驗是否真的要導入一項技術。</p>
<ul>
<li>Don’t even start considering solutions until you <strong>Understa</strong> the problem. Your goal should be to “solve” the problem mostly within the problem domain, not the solution domain.</li>
<li><strong>eNumerate</strong> multiple candidate solutions. Don’t just start prodding at your favorite!</li>
<li>Consider a candidate solution, then read the <strong>Paper</strong> if there is one.</li>
<li>Determine the <strong>Historical context</strong> in which the candidate solution was designed or developed.</li>
<li>Weigh <strong>Advantages</strong> against disadvantages. Determine what was de-prioritized to achieve what was prioritized.</li>
<li><p><strong>Think!</strong> Soberly and humbly ponder how well this solution fits your problem. What fact would need to be different for you to change your mind? For instance, how much smaller would the data need to be before you’d elect not to use Hadoop?</p>
<p>覺得概念如同 <a href="https://en.wikipedia.org/wiki/Donald_Knuth" target="_blank" rel="external"><strong>Donald Ervin Knuth</strong></a> 說過的 <strong>premature optimization is the root of all evil (or at least most of it) in programming</strong> (<em>過早的最佳化是種罪惡</em>)，先把焦點放在<strong>要解決的問題</strong>，而不是解決問題的方法。</p>
</li>
</ul>
<h2 id="否决你方案的领导并不傻！小心让优越感毁掉你的职业生涯"><a href="#否决你方案的领导并不傻！小心让优越感毁掉你的职业生涯" class="headerlink" title="否决你方案的领导并不傻！小心让优越感毁掉你的职业生涯"></a><a href="http://36kr.com/p/5079363.html" target="_blank" rel="external">否决你方案的领导并不傻！小心让优越感毁掉你的职业生涯</a></h2><p>  所謂「文人相輕，武人相重」，工程師這類文人在職場上的確多少會有意見被否決或各執一詞的時候。在溝通當下該如何理性的看待事情，而不被情緒影響，我想是需要學習的一門課題。 這篇文章就以作者自身的體驗來講述成因以及如何解決。</p>
<p>  簡單講就是 <strong>態度</strong> 和 <strong>謙遜</strong>！ 把目標放在問題本身，而非自我或溝通過程。何況「三人行必有我師焉」，每個人的成長、學習、生活方式都不同，多多少少都有可以跟他人學習的地方。共勉之！ </p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/06/19/Weekly-reading-2017-Jun-12-18/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/06/07/The-Ten-Commandments-of-Egoless-Programming/">
                            The Ten Commandments of Egoless Programming
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-06-07T00:00:00+08:00">
	
		    Jun 07, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="軟體十誡"><a href="#軟體十誡" class="headerlink" title="軟體十誡"></a>軟體十誡</h2><p>聖經中有十誡作為宗教律法，而對軟體工程師也有人提出所謂的十誡，雖不至於像宗教律法般的嚴格，但同樣字字珠璣，感同身受。 故特地留一份於此，供我自己及後人景仰XD</p>
<p>軟體工程師的十誡出自<a href="https://en.wikipedia.org/wiki/Gerald_Weinberg" target="_blank" rel="external">Gerald Weinberg</a>在西元1971寫的<a href="https://www.amazon.com/exec/obidos/ASIN/0932633420/codihorr-20" target="_blank" rel="external">The Psychology of Computer Programming</a>這本書。 由<a href="https://blog.codinghorror.com/about-me" target="_blank" rel="external">Jeff Atwood</a>的<a href="https://blog.codinghorror.com/the-ten-commandments-of-egoless-programming" target="_blank" rel="external">部落格文章</a>所整理。</p>
<h3 id="1-Understand-and-accept-that-you-will-make-mistakes"><a href="#1-Understand-and-accept-that-you-will-make-mistakes" class="headerlink" title="1. Understand and accept that you will make mistakes."></a>1. Understand and accept that you will make mistakes.</h3><p>The point is to find them early, before they make it into production. Fortunately, except for the few of us developing rocket guidance software at JPL, mistakes are rarely fatal in our industry, so we can, and should, learn, laugh, and move on.</p>
<h3 id="2-You-are-not-your-code"><a href="#2-You-are-not-your-code" class="headerlink" title="2. You are not your code."></a>2. You are not your code.</h3><p>Remember that the entire point of a review is to find problems, and problems will be found. Don’t take it personally when one is uncovered.</p>
<h3 id="3-No-matter-how-much-“karate”-you-know-someone-else-will-always-know-more"><a href="#3-No-matter-how-much-“karate”-you-know-someone-else-will-always-know-more" class="headerlink" title="3. No matter how much “karate” you know, someone else will always know more."></a>3. No matter how much “karate” you know, someone else will always know more.</h3><p>Such an individual can teach you some new moves if you ask. Seek and accept input from others, especially when you think it’s not needed.</p>
<h3 id="4-Don’t-rewrite-code-without-consultation"><a href="#4-Don’t-rewrite-code-without-consultation" class="headerlink" title="4. Don’t rewrite code without consultation."></a>4. Don’t rewrite code without consultation.</h3><p>There’s a fine line between “fixing code” and “rewriting code.” Know the difference, and pursue stylistic changes within the framework of a code review, not as a lone enforcer.</p>
<h3 id="5-Treat-people-who-know-less-than-you-with-respect-deference-and-patience"><a href="#5-Treat-people-who-know-less-than-you-with-respect-deference-and-patience" class="headerlink" title="5. Treat people who know less than you with respect, deference, and patience."></a>5. Treat people who know less than you with respect, deference, and patience.</h3><p>Nontechnical people who deal with developers on a regular basis almost universally hold the opinion that we are prima donnas at best and crybabies at worst. Don’t reinforce this stereotype with anger and impatience.</p>
<h3 id="6-The-only-constant-in-the-world-is-change"><a href="#6-The-only-constant-in-the-world-is-change" class="headerlink" title="6. The only constant in the world is change."></a>6. The only constant in the world is change.</h3><p>Be open to it and accept it with a smile. Look at each change to your requirements, platform, or tool as a new challenge, not as some serious inconvenience to be fought.</p>
<h3 id="7-The-only-true-authority-stems-from-knowledge-not-from-position"><a href="#7-The-only-true-authority-stems-from-knowledge-not-from-position" class="headerlink" title="7. The only true authority stems from knowledge, not from position."></a>7. The only true authority stems from knowledge, not from position.</h3><p>Knowledge engenders authority, and authority engenders respect – so if you want respect in an egoless environment, cultivate knowledge.</p>
<h3 id="8-Fight-for-what-you-believe-but-gracefully-accept-defeat"><a href="#8-Fight-for-what-you-believe-but-gracefully-accept-defeat" class="headerlink" title="8. Fight for what you believe, but gracefully accept defeat."></a>8. Fight for what you believe, but gracefully accept defeat.</h3><p>Understand that sometimes your ideas will be overruled. Even if you do turn out to be right, don’t take revenge or say, “I told you so” more than a few times at most, and don’t make your dearly departed idea a martyr or rallying cry.</p>
<h3 id="9-Don’t-be-“the-guy-in-the-room-”"><a href="#9-Don’t-be-“the-guy-in-the-room-”" class="headerlink" title="9. Don’t be “the guy in the room.”"></a>9. Don’t be “the guy in the room.”</h3><p>Don’t be the guy coding in the dark office emerging only to buy cola. The guy in the room is out of touch, out of sight, and out of control and has no place in an open, collaborative environment.</p>
<h3 id="10-Critique-code-instead-of-people-–-be-kind-to-the-coder-not-to-the-code"><a href="#10-Critique-code-instead-of-people-–-be-kind-to-the-coder-not-to-the-code" class="headerlink" title="10. Critique code instead of people – be kind to the coder, not to the code."></a>10. Critique code instead of people – be kind to the coder, not to the code.</h3><p>As much as possible, make all of your comments positive and oriented to improving the code. Relate comments to local standards, program specs, increased performance, etc.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/06/07/The-Ten-Commandments-of-Egoless-Programming/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/04/11/Hadoop-Distributed-File-System/">
                            Hadoop Distributed File System
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-04-11T22:59:38+08:00">
	
		    Apr 11, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="The-Hadoop-Distributed-File-System"><a href="#The-Hadoop-Distributed-File-System" class="headerlink" title="The Hadoop Distributed File System"></a>The Hadoop Distributed File System</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>在 Hadoop 架構中，較熱門、常見的都是上層的計算應用，例如 MapReduce、Hive、Pig、Spark、Mahout 等等。但這些應用其中有一個重要的元素，就是在底層的分散式資料儲存 HDFS！<br>而在 2010 年左右，Yahoo!就已在 production 上以 25000 台server 建構運行了多個 cluster，其中儲存了 25 PB的資料。而最大的 cluster 包含將近 3500 台server。</p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p>在 HDFS 的架構上，每個 cluster 係由 1 個 NameNode 和 多個 DataNode 所組成。並將資料分作 metadata 和 application data 各自儲存在 NameNode 和 DataNode 上，並透過 replication 的方式來達到資料的 reliability。</p>
<ul>
<li><h3 id="NameNode"><a href="#NameNode" class="headerlink" title="NameNode"></a>NameNode</h3><p>主要儲存了一份稱作 <strong>Namespace</strong> 的檔案結構，就像是檔案路徑 _root_dir/sub<em>dir</em>/file_ 由 file 和 directories 所組成並以階層的方式呈現，<br>其中儲存了包含 permissions、modification、access times、namespace 和 disk space quotas 這類 metadata。<br>NameNode 會將 Namespace 存在記憶體中，稱作 <strong>image</strong>；而 image 修改歷程的資料則稱作 <strong>journal</strong>；亦可將 image 存於底層檔案系統作 persistent，稱作 <strong>check-point</strong>。<br>實際的檔案內容，被切分為預設 128 MB(可調整) 大小的 <strong>block</strong> 來作為最小的資料單元，而分散的 replicate 到各個 DataNode 上，<br>而 NameNode 會維護一份 namespace tree 和一份各個 block 各自放在哪個 DataNode 實體路徑的 mapping table。<br>讀取檔案時，Client 端會先到 NameNode 取得擁有所需 data block 而且最近的 DataNode 位置。<br>寫入檔案時，Client 端會先到 NameNode 取得三個 DataNode 的位置後，再將 data block 寫到這三個 DataNode</p>
</li>
<li><h3 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h3><ul>
<li><h4 id="Namespace-ID-Storage-ID"><a href="#Namespace-ID-Storage-ID" class="headerlink" title="Namespace ID / Storage ID"></a>Namespace ID / Storage ID</h4><p>在每個 HDFS 的 cluster 中，會有唯一的 Namespace ID，用來確認 cluster 中的 NameNode 和 DataNode 是管理和儲存同一份資料和結構。<br><br>DataNode 在第一次啟動時，會向設定的 NameNode 進行 handshake 來<strong>取得</strong>該 cluster 的 Namespace ID。<br>DataNode 非第一次啟動時，會向設定的 NameNode 進行 handshake 來<strong>驗證</strong>該 cluster 的 Namespace ID 和自己的是否相同。<br><br>DataNode 和 NameNode 進行的 handshake 中也會<strong>驗證</strong>雙方的軟體版本，<br>如果 Namespace ID 或軟體版本不同的話，DataNode 都會自動關機，因為若 Namespace ID 不同，則可能雙方儲存的資料跟結構都不同；若軟體版本不同，則可能對資料處理的方式不同，造成錯誤。<br><br>Handshake 結束後，就表示 DataNode 和 NameNode 互相註冊了，DataNode 會產生唯一的 <strong>Storage ID</strong> 作為後續和 NameNode 溝通使用。</p>
</li>
<li><h4 id="Data-block-Block-report"><a href="#Data-block-Block-report" class="headerlink" title="Data block / Block report"></a>Data block / Block report</h4><p>每個儲存在 DataNode 上的 <strong>Data Block</strong> 會分作兩個檔案儲存在本地端的 native 檔案系統，第一個檔案存放資料本體；第二個檔案存放 metadata 包含checksums 和 時間戳記。 <em>(P.S Data Block 所佔的檔案大小依其實際儲存的資料而定，非固定)</em><br><br>DataNode 則透過 <strong>Block report</strong> 告訴 NameNode 它存了哪塊 Data block，它的 block id、建立時間、block 長度。<br>Block report 除了在 DataNode 啟動後送出第一次後，後面則每小時發送一次。</p>
</li>
<li><h4 id="Heartbeats"><a href="#Heartbeats" class="headerlink" title="Heartbeats"></a>Heartbeats</h4><p>DataNode 每隔3秒會發送一次 heartbeats 給 NameNode，裡面夾帶 <em>總共可使用的空間大小</em> 、<em>目前已使用的空間大小</em> 和 <em>目前有多少個正在進行的檔案傳輸</em>，<br>這些資訊都能讓 NameNode 作爲空間使用和Load blance 的決策考量。<br>NameNode 如果10分鐘內沒收到 heartbeats 的話，會將 DataNode 視為離線，且準備啟動 replicas 作業將離線 DataNode 上的 Data block 複製到還在線上的 DataNodes。<br> 因為 NameNode 不主動和 DataNode 連線，所以會在 heartbeats 的 response 中夾帶下列命令來進行管理：</p>
</li>
<li>replicate blocks to other nodes</li>
<li>remove local block replicas</li>
<li>re-register or to shut down the node</li>
<li>send an immediate block report</li>
</ul>
</li>
<li><h3 id="HDFS-Client"><a href="#HDFS-Client" class="headerlink" title="HDFS Client"></a>HDFS Client</h3></li>
<li><h3 id="Image-and-Journal"><a href="#Image-and-Journal" class="headerlink" title="Image and Journal"></a>Image and Journal</h3></li>
<li><h3 id="Checkpoint-Node"><a href="#Checkpoint-Node" class="headerlink" title="Checkpoint Node"></a>Checkpoint Node</h3></li>
<li><h3 id="Backup-Node"><a href="#Backup-Node" class="headerlink" title="Backup Node"></a>Backup Node</h3></li>
<li><h3 id="Upgrades-File-System-Snapshots"><a href="#Upgrades-File-System-Snapshots" class="headerlink" title="Upgrades, File System Snapshots"></a>Upgrades, File System Snapshots</h3></li>
</ul>
<h2 id="FILE-I-O-OPERATIONS-AND-REPLICA-MANGEMENT"><a href="#FILE-I-O-OPERATIONS-AND-REPLICA-MANGEMENT" class="headerlink" title="FILE I/O OPERATIONS AND REPLICA MANGEMENT"></a>FILE I/O OPERATIONS AND REPLICA MANGEMENT</h2><ul>
<li><h3 id="File-Read-and-Write"><a href="#File-Read-and-Write" class="headerlink" title="File Read and Write"></a>File Read and Write</h3></li>
<li><h3 id="Block-Placement"><a href="#Block-Placement" class="headerlink" title="Block Placement"></a>Block Placement</h3></li>
<li><h3 id="Replication-management"><a href="#Replication-management" class="headerlink" title="Replication management"></a>Replication management</h3></li>
<li><h3 id="Balancer"><a href="#Balancer" class="headerlink" title="Balancer"></a>Balancer</h3></li>
<li><h3 id="Block-Scanner"><a href="#Block-Scanner" class="headerlink" title="Block Scanner"></a>Block Scanner</h3></li>
<li><h3 id="Decommissioing"><a href="#Decommissioing" class="headerlink" title="Decommissioing"></a>Decommissioing</h3></li>
<li><h3 id="Inter-Cluster-Data-Copy"><a href="#Inter-Cluster-Data-Copy" class="headerlink" title="Inter-Cluster Data Copy"></a>Inter-Cluster Data Copy</h3></li>
</ul>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref:"></a><em>ref</em>:</h3><p><a href="http://storageconference.us/2010/Papers/MSST/Shvachko.pdf" target="_blank" rel="external">The Hadoop Distributed File System</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/04/11/Hadoop-Distributed-File-System/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/04/08/What-and-how-about-http-connection-reuse/">
                            What and how about http persistent connection
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-04-08T00:00:00+08:00">
	
		    Apr 08, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p><img src="./imgs/connection.png" alt="img"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>工作上有負責 Push 功能的開發，簡單講就是把要送給 Client 端的訊息，透過 http protocol 發送到 Google 和 Apple 的 Push Service，GCM 和 APNS。<br>近來，一方面為了因應越來越大的 Push 發送量；一方面也為了減少 Client 接收 Push 訊息的 latency，而開始進行調整。 首要就是先找出功能的 bottleneck，接著依照不同類型 CPU-Bound 或 IO-Bound 而有不同的調整方式。<br>而 IO-Bound 的部分，就先來 review 在 http protocol 和 Java 的規範上什麼是 http persistent connection。</p>
<hr>
<h2 id="HTTP-Persistent-Connection"><a href="#HTTP-Persistent-Connection" class="headerlink" title="HTTP Persistent Connection"></a>HTTP Persistent Connection</h2><h3 id="什麼是-HTTP-Persistent-Connection"><a href="#什麼是-HTTP-Persistent-Connection" class="headerlink" title="什麼是 HTTP Persistent Connection?"></a>什麼是 HTTP Persistent Connection?</h3><ul>
<li>Allowing multiple requests and responses to be carried over a single connection.</li>
</ul>
<h3 id="Advantages"><a href="#Advantages" class="headerlink" title="Advantages"></a>Advantages</h3><ul>
<li>Lower CPU and memory usage (because fewer connections are open simultaneously).</li>
<li>Enables HTTP pipelining of requests and responses.</li>
<li>Reduced network congestion (fewer TCP connections).</li>
<li>Reduced latency in subsequent requests (no handshaking).</li>
<li>Errors can be reported without the penalty of closing the TCP connection.</li>
</ul>
<h3 id="Disadvantages"><a href="#Disadvantages" class="headerlink" title="Disadvantages"></a>Disadvantages</h3><ul>
<li>Resource will unavailable when connection not close well, it may may check timeout or others for ensure connection reusable.</li>
</ul>
<h3 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h3><p>在 HTTP 1.1 之後預設所有的 connection 都是 persistent 的，除非額外註明<br><code>connection: close</code><br>來表示 connection 會在 response 後結束。因此 <strong>HTTP implementations SHOULD implement persistent connections.</strong></p>
<p>但在 HTTP 1.0 時並無 persistent connection 的定義，得在 header 中註明<br><code>connection: keep-alive</code><br>來表示 connection 是 persistent 的</p>
<p>實作 Server side 的 persistent connection 也有下列的規則來判斷，來相容不同 Client 端的 Request：</p>
<ol>
<li>If the “close” connection option is present, the connection will not persist after the current response</li>
<li>If the received protocol is HTTP/1.1 (or later), the connection will persist after the current response</li>
<li>If the received protocol is HTTP/1.0, the “keep-alive” connection option is present, the recipient is not a proxy, and the recipient wishes to honor the HTTP/1.0 “keep-alive” mechanism, the connection will persist after the current response</li>
<li>The connection will close after the current response.</li>
</ol>
<hr>
<h2 id="Java-HttpURLConnection"><a href="#Java-HttpURLConnection" class="headerlink" title="Java HttpURLConnection"></a>Java HttpURLConnection</h2><p>最後來看看在 Java 中如何支援 persistent connection</p>
<ul>
<li>Each <strong>HttpURLConnection</strong> instance is used to make a single request <strong>but</strong> the underlying network connection to the HTTP server may be <strong>transparently shared by other instances</strong>.</li>
</ul>
<p>也就是說，如果透過 <strong>HttpURLConnection</strong> 作 http 介接的話，不用 concern 如何 persistent connection ，它會解決的！</p>
<p>那我們到底是不是真的能把一個 connectiob 關掉呢？</p>
<ul>
<li><h4 id="Different-of-close-and-disconnect"><a href="#Different-of-close-and-disconnect" class="headerlink" title="Different of close() and disconnect()"></a>Different of <em>close()</em> and <em>disconnect()</em></h4><ul>
<li>Calling the <strong>close()</strong> methods on the InputStream or OutputStream of an HttpURLConnection after a request may free network resources associated with this instance but has <strong>no effect on any shared persistent connection</strong>.</li>
<li>Calling the <strong>disconnect()</strong> method may close the underlying socket <strong>if a persistent connection is otherwise idle at that time</strong>.</li>
<li>HTTP header that influences connection persistence is:<br><code>Connection: close</code></li>
</ul>
</li>
</ul>
<p>如上所述就算直接呼叫 close() 或 disconnect() ，一樣是 JVM 會自行決定是否真的關閉 connection。</p>
<p>JVM 也提供了一些參數來控制 persistent connection，</p>
<ul>
<li><p><em>http.keepalive (default: true)</em><br>Indicates if persistent connections should be supported. They improve performance by allowing the underlying socket connection to be reused for multiple http requests. If this is set to true then persistent connections will be requested with HTTP 1.1 servers.</p>
</li>
<li><p><em>http.maxConnections (default: 5)</em><br>If HTTP keepalive is enabled this value determines the maximum number of idle connections that will be simultaneously kept alive, per destination.</p>
</li>
</ul>
<hr>
<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><ul>
<li><a href="https://medium.com/r/?url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHTTP_persistent_connection" target="_blank" rel="external">HTTP persistent connection</a></li>
<li><a href="https://medium.com/r/?url=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7230%23section-6.3" target="_blank" rel="external">RFC7230</a></li>
<li><a href="https://medium.com/r/?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F35208950%2Fjava-httpurlconnection-and-pooling" target="_blank" rel="external">Java HttpURLConnection and pooling</a></li>
<li><a href="https://medium.com/r/?url=http%3A%2F%2Fdocs.oracle.com%2Fjavase%2F6%2Fdocs%2Ftechnotes%2Fguides%2Fnet%2Fhttp-keepalive.html" target="_blank" rel="external">Persistent Connections</a></li>
</ul>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/04/08/What-and-how-about-http-connection-reuse/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/page/2/">
                    <span>OLDER POSTS</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">page 1 of 3</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 W.D. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">W.D</h4>
        
            <div id="about-card-bio"><p><em>programmer and play a lot in backend.</em></p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Taiwan
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://option0417.github.io/2011/10/26/Apache2-2-Subversion1-7-0-安裝設定/">
                            <h3 class="media-heading">Apache2.2 + Subversion1.7.0 安裝設定</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Oct 26, 2011
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://option0417.github.io/2014/09/18/Reading-超爆蘋果橘子經濟學/">
                            <h3 class="media-heading">[Reading] 超爆蘋果橘子經濟學</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Sep 18, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://option0417.github.io/2016/09/12/Reading-沒了名片，你還剩下什麼？/">
                            <h3 class="media-heading">[Reading] 沒了名片，你還剩下什麼？</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Sep 12, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://option0417.github.io/2016/11/13/Reading-智慧型資產配置/">
                            <h3 class="media-heading">[Reading] 智慧型資產配置</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 13, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://option0417.github.io/2016/11/14/Note-人類行為大數據分析-資料科學如何應用在教育及醫療領域/">
                            <h3 class="media-heading">[Note] 人類行為大數據分析: 資料科學如何應用在教育及醫療領域</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 14, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                11 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/nature-forest-industry-rails.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script>
<!--SCRIPTS END-->


    </body>
</html>
